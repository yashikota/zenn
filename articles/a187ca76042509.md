---
title: "GASã§Slackã«é€šçŸ¥ã•ã‚ŒãŸNotionã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’Discordã«è»¢é€ã™ã‚‹"
emoji: "ğŸ”"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["gas", "slack", "discord", "notion"]
published: true
---

:::message

WebhookãŒã‚µãƒãƒ¼ãƒˆã•ã‚ŒãŸã‚ˆã†ãªã®ã§ã€ã“ã¡ã‚‰ã§ã‚„ã‚‹ã®ãŒã„ã„ã¨æ€ã„ã¾ã™ã€‚  

https://x.com/NotionHQ/status/1864006087659098439

:::

## æ¦‚è¦

Notionã«ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ›´æ–°ã‚’æ¤œçŸ¥ã—ã¦ç‰¹å®šã®å‡¦ç†ã‚’è¡Œã†automationsã¨ã„ã†æ©Ÿèƒ½ãŒã‚ã‚Šã€ãã®ä¸­ã«Slackã«é€šçŸ¥ã™ã‚‹ã‚‚ã®ã‚‚ã‚ã‚Šã¾ã™ã€‚  

https://www.notion.so/help/database-automations

å®Ÿéš›ã«å‹•ä½œã•ã›ã‚‹ã¨ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚Šã¾ã™ã€‚  

![slack notification example](/images/slack-discord/001.png)

ãŸã ã€æ®‹å¿µãªãŒã‚‰Slackä»¥å¤–ã«æœªå¯¾å¿œã§ã€Discordã‚’ãƒ¡ã‚¤ãƒ³ã«ä½¿ã£ã¦ã„ã‚‹èº«ã«ã¨ã£ã¦æ­¯ãŒã‚†ã„æ€ã„ã‚’ã—ã¦ã„ã¾ã™ã€‚  
ãã“ã§ã€Slackã«é£›ã‚“ã§ããŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’Discordã«è»¢é€ã™ã‚‹ã“ã¨ã§é€šçŸ¥ã‚’é£›ã°ã™ã‚ˆã†ã«ã—ã¦ã¿ã¾ã—ãŸã€‚  
ã¾ãŸã€ãŠé‡‘ã‚’æ›ã‘ãšã«é‹ç”¨ã—ãŸã„ãŸã‚GASã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚  

## å®Ÿè£…

ã“ã‚Œã‚‰ã®è¨˜äº‹ã‚’å‚è€ƒã«Slack Botã®ç”¨æ„ã¨GASã¨ã®é€£æºã€Discordã®Webhookã®ä½œæˆã‚’è¡Œã£ã¦ãã ã•ã„ã€‚  

https://qiita.com/flowernotfound/items/318daa37b72558175b4a
https://zenn.dev/lambta/articles/5edbda4ccb1ec6#webhook%E4%BD%9C%E6%88%90

ã¾ãŸå®Ÿè¡Œã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã«ãªã‚Šã¾ã™ã€‚  
`webhookUrl`ã«å–å¾—ã—ãŸURLã‚’å…¥ã‚Œã‚‹ã¨ã®ã€payloadã®fieldsã‚’è¦ä»¶ã«åˆã‚ã›ã¦ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  

```js
function sendToDiscord(jsonData) {
  var webhookUrl = "https://discord.com/api/webhooks/...";
  
  var payload = generateDiscordPayload(jsonData);
  
  var options = {
    "method": "POST",
    "contentType": "application/json",
    "payload": payload
  };
  
  UrlFetchApp.fetch(webhookUrl, options);
}

function generateDiscordPayload(jsonData) {
  var data = JSON.parse(jsonData);
  var event = data.event;

  var payload = {
    "content": "",
    "embeds": [{
      "title": event.blocks[1].fields[0].text.split('|')[1].slice(0, -1).replace('>', ''),
      "url": event.blocks[1].fields[0].text.split('|')[0].slice(2, -1),
      "thumbnail": {
        "url": event.blocks[0].elements[0].image_url
      },
      "color": parseInt("006e54", 16),
      "fields": [
        {
          "name": "Status",
          "value": event.blocks[1].fields[2].text.replace('*Status*\n', '').replace(/~/g, ''),
          "inline": false
        },
        {
          "name": "Deadline",
          "value": event.blocks[2].elements[0].text.split('*Deadline* ')[1].split('    ')[0],
          "inline": false
        },
        {
          "name": "Assign",
          "value": event.blocks[2].elements[0].text.split('*Assign* ')[1],
          "inline": false
        },
        {
          "name": "Editor",
          "value": event.blocks[0].elements[1].text.split('*')[1],
          "inline": false
        }
      ],
      "footer": {
        "icon_url": event.bot_profile.icons.image_72,
        "text": "Updated at " + new Date(parseFloat(event.ts) * 1000).toLocaleString("ja-JP")
      }
    }]
  };

  return JSON.stringify(payload);
}

function doPost(e) {
  const jsonStr = e.postData.getDataAsString();
  
  try {
    sendToDiscord(jsonStr);
  } catch (error) {
    console.log("Error sending to Discord: " + error.message);
  }

  var params = JSON.parse(e.postData.getDataAsString());
  return ContentService.createTextOutput(params.challenge);
}
```

å®Ÿè¡Œã•ã‚Œã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªé€šçŸ¥ãŒDiscordã«é£›ã‚“ã§ãã¾ã™ğŸ¥°  

![discord notification example](/images/slack-discord/002.png)
