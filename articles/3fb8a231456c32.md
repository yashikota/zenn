---
title: "Windowsã§VSCode + OpenCV(C++)ã®é–‹ç™ºç’°å¢ƒæ§‹ç¯‰"
emoji: "ğŸ› ï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["OpenCV", "Windows", "CMake"]
published: true
---

WSLã§Webcamã‚’ä½¿ç”¨ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã‚ã‚“ã©ãã•ã‹ã£ãŸã®ã§ã€Windowsã®ç’°å¢ƒã«C++ã§ã®OpenCVã®ç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¾ã—ãŸã€‚  
Windowsã§OpenCVã®é–‹ç™ºã‚’è¡ŒãŠã†ã¨ã™ã‚‹ã¨Visual Studioã®ä½¿ç”¨ä¾‹ã°ã‹ã‚Šå‡ºã¦ãã¾ã™ãŒã€ä½¿ã„æ…£ã‚ŒãŸVSCodeã‚’ä½¿ã„ãŸã‹ã£ãŸã®ã§ã€Visual Studioã‚’ä½¿ã‚ãšã«é–‹ç™ºã§ãã‚‹ç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¦ã„ãã¾ã™ã€‚  
ç­†è€…ã®ç’°å¢ƒã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚  

- Windows 11
- Visual Studio 2022
- PowerShell 7.3
- CMake 3.27
- OpenCV 4.8

## Visual Studioã¨CMakeã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®éš›ã«ã¯Visual Studioã¯å¿…è¦ãªã„ã§ã™ãŒã€ãƒ“ãƒ«ãƒ‰ã®éš›ã«ã¯å¿…è¦ãªã®ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚  
ã¾ãŸOpenCVã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ãŸã‚ã«CMakeãŒå¿…è¦ãªã®ã§ã€ãã¡ã‚‰ã‚‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚  
è©³ã—ã„ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã¯ä»¥ä¸‹ã®ã‚µã‚¤ãƒˆã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚  

https://swallow-incubate.com/archives/blog/20200508

## OpenCVã®ãƒ“ãƒ«ãƒ‰ã¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

1. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã™ã‚‹ã€‚  

```sh
mkdir opencv
cd opencv
```

2. opencvã¨opencv_contribã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã€‚  

```sh
curl -Lo opencv.zip https://github.com/opencv/opencv/archive/4.x.zip
curl -Lo opencv_contrib.zip https://github.com/opencv/opencv_contrib/archive/4.x.zip
```

3. è§£å‡ã™ã‚‹ã€‚  

`Expand-Archive`ã§è§£å‡ã§ãã¾ã™ãŒã€`opencv/opencv-4.x/â€¦`ã®ã‚ˆã†ãªãƒ‘ã‚¹ã«ãªã‚‹ã®ã§7zipã§ã‚„ã‚‹ã‹è§£å‡å¾Œæ‰‹å‹•ã§ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®ç§»å‹•ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚  

4. ãƒ“ãƒ«ãƒ‰ç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã™ã‚‹ã€‚  

```sh
mkdir build
cd build
```

5. ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã€‚  

```sh
cmake -G "Visual Studio 17 2022" -A x64 -D OPENCV_EXTRA_MODULES_PATH=../opencv_contrib-4.x/modules -D BUILD_opencv_world=ON ../opencv-4.x
& 'C:\Program Files\Microsoft Visual Studio\2022\Community\MSBuild\Current\Bin\MSBuild.exe' .\ALL_BUILD.vcxproj /p:Configuration=Release /p:Platform=x64
& 'C:\Program Files\Microsoft Visual Studio\2022\Community\MSBuild\Current\Bin\MSBuild.exe' .\INSTALL.vcxproj /p:Configuration=Release /p:Platform=x64
```

6. ãƒ‘ã‚¹ã‚’é€šã™ã€‚

â€»ãƒ‘ã‚¹ã¯é©å®œèª­ã¿æ›¿ãˆã¦ãã ã•ã„ã€‚  

- `C:\opencv\build\install`
- `C:\opencv\build\install\include`
- `C:\opencv\build\install\x64\vc17\bin`

ãƒ‘ã‚¹ã‚’é€šã—ãŸå¾Œã€PowerShellã§`opencv_version`ã¨å…¥åŠ›ã—ã¦ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ãŒå‡ºã¦ããŸã‚‰OKã€‚  

## OpenCVã‚’ä½¿ã£ã¦ã¿ã‚‹

ã•ã‚ã„ã‚ˆã„ã‚ˆOpenCVã‚’ä½¿ã£ã¦ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚  
é©å½“ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã€ä»¥ä¸‹ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’`main.cpp`ã«æ›¸ãã¾ã™ã€‚  

```cpp
#include "opencv2/highgui/highgui.hpp"
#include "opencv2/opencv.hpp"

int main() {
    cv::VideoCapture cap(0);
    if (!cap.isOpened()) return -1;

    cv::Mat frame;
    while (cap.read(frame)) {
        cv::imshow("test", frame);
        const int key = cv::waitKey(1);
        if (key == 'q') break;
    }
    cv::destroyAllWindows();

    return 0;
}
```

ãã®å¾Œã€main.cppã¨åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«`CMakeLists.txt`ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€ä»¥ä¸‹ã®å†…å®¹ã‚’æ›¸ãã¾ã™ã€‚  

```cmake
cmake_minimum_required(VERSION 3.0.0)
project(test VERSION 0.1.0 LANGUAGES CXX)

find_package(OpenCV REQUIRED)
include_directories(${OpenCV_INCLUDE_DIRS})

add_executable(test main.cpp)
target_link_libraries( ${PROJECT_NAME} ${OpenCV_LIBS} )
```

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™(è¦PowerShell 7ä»¥é™)ã€‚  

```sh
cmake . -B build && cmake --build build --config Release && build\Release\test.exe
```

ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒè¡¨ç¤ºã•ã‚Œã€Webcamã®æ˜ åƒãŒè¡¨ç¤ºã•ã‚Œã‚Œã°æˆåŠŸã§ã™ï¼  

## å‚è€ƒæ–‡çŒ®

https://docs.opencv.org/4.x/d7/d9f/tutorial_linux_install.html
https://swallow-incubate.com/archives/blog/20200508
https://sh-yoshida.hatenablog.com/entry/2017/05/27/012755
https://pystyle.info/opencv-how-to-build-opencv-on-windows
