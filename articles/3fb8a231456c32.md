---
title: "Windows11ã¨VSCodeã§C++ç‰ˆOpenCVã®é–‹ç™ºç’°å¢ƒæ§‹ç¯‰"
emoji: "ğŸ› ï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["OpenCV", "Windows"]
published: true
---

Windowsã§OpenCVã®é–‹ç™ºã‚’è¡ŒãŠã†ã¨ã™ã‚‹ã¨Visual Studioã®ä½¿ç”¨ä¾‹ã°ã‹ã‚Šå‡ºã¦ãã¾ã™ãŒã€ä½¿ã„æ…£ã‚ŒãŸVSCodeã‚’ä½¿ã„ãŸã‹ã£ãŸã®ã§ã€Visual Studioã‚’ä½¿ã‚ãšã«é–‹ç™ºã§ãã‚‹ç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¦ã„ãã¾ã™ã€‚  

ç’°å¢ƒã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚  

- Windows 11
- OpenCV 4.9
- PowerShell 7.3
- CMake 3.27

## CMakeã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```sh
winget install Kitware.CMake
```

ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ã€‚  
ã‚‚ã—wingetãŒãªã„å ´åˆã¯ [ã‚¢ãƒ—ãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼](https://apps.microsoft.com/detail/9nblggh4nns1?rtc=1&hl=ja-jp&gl=JP)ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚  

:::details wingetã‚’ä½¿ã‚ãšã«å…¥ã‚Œã‚‹æ–¹æ³•

https://github.com/Kitware/CMake/releases

`cmake-{version}-windows-x86_64.msi` ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ & ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚  

:::

## OpenCVã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

https://github.com/opencv/opencv/releases

ä¸Šè¨˜ãƒªãƒ³ã‚¯ã‹ã‚‰ `opencv-{version}-windows.exe` ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚  

ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¾Œã€å®Ÿè¡Œã™ã‚‹ã¨OpenCVã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ•ã‚©ãƒ«ãƒ€ã‚’é¸æŠã™ã‚‹ç”»é¢ã«ãªã‚‹ã®ã§ã€é©å½“ãªãƒ‘ã‚¹ã‚’è¨­å®šã—ã¾ã™ã€‚  
ã“ã“ã§ã¯ `C:\Users\{user}\env` ä¸‹ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚  

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã€ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¾ã™ã€‚  
PowerShellã‚’é–‹ãã€

```txt
setx OpenCV_DIR C:\Users\{user}\env\OpenCV\build\x64\vc17
```

ã¨å…¥åŠ›ã—ã¦ä¸‹ã•ã„ã€‚  
ã¾ãŸã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ç’°å¢ƒå¤‰æ•°ã® `Path` ã« `%OPENCV_DIR%\bin` ã¨ `%OPENCV_DIR%\lib` ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚  

ç’°å¢ƒå¤‰æ•°ã®è¨­å®šå¾Œã€PowerShellã‚’é–‹ãç›´ã—ã€ `opencv_version` ã¨å…¥åŠ›ã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ãŒå‡ºã¦ãã‚Œã°OKã§ã™ã€‚  

```txt
$ opencv_version
4.9.0
```

è©³ã—ã„ç’°å¢ƒå¤‰æ•°ã®è¨­å®šæ–¹æ³•ã¯ä»¥ä¸‹ã®ã‚µã‚¤ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚  
https://docs.opencv.org/4.x/d3/d52/tutorial_windows_install.html#tutorial_windows_install_path

:::details ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ãƒ“ãƒ«ãƒ‰ã™ã‚‹å ´åˆ

è‡ªåˆ†ã§ãƒ“ãƒ«ãƒ‰ã™ã‚‹å ´åˆã«ã¯ `msbuild` ãŒå¿…è¦ã§ã™ã€‚  
Visual Studio 2022 ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã‹ [ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«](https://www.kkaneko.jp/tools/win/buildtool2022.html)ã—ã¦ãã ã•ã„ã€‚  

1. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã™ã‚‹ã€‚  

```sh
mkdir opencv
cd opencv
```

2. opencvã¨opencv_contribã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã€‚  

```sh
curl -Lo opencv.zip https://github.com/opencv/opencv/archive/4.x.zip
curl -Lo opencv_contrib.zip https://github.com/opencv/opencv_contrib/archive/4.x.zip
```

3. è§£å‡ã™ã‚‹ã€‚  

`Expand-Archive`ã§è§£å‡ã§ãã¾ã™ãŒã€`opencv/opencv-4.x/â€¦`ã®ã‚ˆã†ãªãƒ‘ã‚¹ã«ãªã‚‹ã®ã§7zipã§ã‚„ã‚‹ã‹è§£å‡å¾Œæ‰‹å‹•ã§ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®ç§»å‹•ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚  

4. ãƒ“ãƒ«ãƒ‰ç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã™ã‚‹ã€‚  

```sh
mkdir build
cd build
```

5. ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã€‚  

Visual Studio 17 2022ã§ã€x64å‘ã‘ã®Releaseãƒ“ãƒ«ãƒ‰ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚  

```sh
cmake -G "Visual Studio 17 2022" -A x64 -D OPENCV_EXTRA_MODULES_PATH=../opencv_contrib-4.x/modules -D BUILD_opencv_world=ON ../opencv-4.x
& 'C:\Program Files\Microsoft Visual Studio\2022\Community\MSBuild\Current\Bin\MSBuild.exe' .\ALL_BUILD.vcxproj /p:Configuration=Release /p:Platform=x64
& 'C:\Program Files\Microsoft Visual Studio\2022\Community\MSBuild\Current\Bin\MSBuild.exe' .\INSTALL.vcxproj /p:Configuration=Release /p:Platform=x64
```

6. ãƒ‘ã‚¹ã‚’é€šã™ã€‚

â€»ãƒ‘ã‚¹ã¯é©å®œèª­ã¿æ›¿ãˆã¦ãã ã•ã„ã€‚  

- `C:\opencv\build\install`
- `C:\opencv\build\install\include`
- `C:\opencv\build\install\x64\vc17\bin`

ãƒ‘ã‚¹ã‚’é€šã—ãŸå¾Œã€PowerShellã§`opencv_version`ã¨å…¥åŠ›ã—ã¦ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ãŒå‡ºã¦ããŸã‚‰OKã€‚  

:::

## OpenCVã‚’ä½¿ã£ã¦ã¿ã‚‹

ã“ã‚Œã§ç’°å¢ƒã¯æ•´ã£ãŸã®ã§OpenCVã‚’ä½¿ã£ãŸãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆã—ã¾ã™ã€‚  
`main.cpp` ã¨ `CMakeLists.txt` ã®2ã¤ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ç”¨æ„ã—ã¾ã™ã€‚  

```cpp:main.cpp
#include "opencv2/highgui/highgui.hpp"
#include "opencv2/opencv.hpp"

int main() {
    cv::VideoCapture cap(0);
    if (!cap.isOpened()) return -1;

    cv::Mat frame;
    while (cap.read(frame)) {
        cv::imshow("test", frame);
        const int key = cv::waitKey(1);
        if (key == 'q') break;
    }
    cv::destroyAllWindows();

    return 0;
}
```

```cmake:CMakeLists.txt
cmake_minimum_required(VERSION 3.0.0)
project(test VERSION 0.1.0 LANGUAGES CXX)

find_package(OpenCV REQUIRED)
include_directories(${OpenCV_INCLUDE_DIRS})

add_executable(test main.cpp)
target_link_libraries( ${PROJECT_NAME} ${OpenCV_LIBS} )
```

ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚  

```sh
cmake . -B build && cmake --build build --config Release && build\Release\test.exe
```

ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒè¡¨ç¤ºã•ã‚Œã€Webcamã®æ˜ åƒãŒè¡¨ç¤ºã•ã‚Œã‚Œã°æˆåŠŸã§ã™ï¼  

## å‚è€ƒæ–‡çŒ®

https://docs.opencv.org/4.x/d7/d9f/tutorial_linux_install.html
https://swallow-incubate.com/archives/blog/20200508
https://sh-yoshida.hatenablog.com/entry/2017/05/27/012755
https://pystyle.info/opencv-how-to-build-opencv-on-windows
