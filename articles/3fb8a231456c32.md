---
title: "Windowsã¨VSCodeã§C++ç‰ˆOpenCVã®é–‹ç™ºç’°å¢ƒæ§‹ç¯‰"
emoji: "ğŸ› ï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["OpenCV", "Windows"]
published: true
---

Windowsã§OpenCVã®é–‹ç™ºã‚’è¡ŒãŠã†ã¨ã™ã‚‹ã¨Visual Studioã®ä½¿ç”¨ä¾‹ã°ã‹ã‚Šå‡ºã¦ãã¾ã™ãŒã€ä½¿ã„æ…£ã‚ŒãŸVSCodeã‚’ä½¿ã„ãŸã‹ã£ãŸã®ã§ã€Visual Studioã‚’ä½¿ã‚ãšã«é–‹ç™ºã§ãã‚‹ç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¦ã„ãã¾ã™ã€‚  

ç’°å¢ƒã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚  

- Windows 11
- OpenCV 4.9
- CMake 3.27

## CMakeã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

https://github.com/Kitware/CMake/releases

`cmake-{version}-windows-x86_64.msi` ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ & ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚  

:::details wingetã‚’ä½¿ã†å ´åˆ

```sh
winget install Kitware.CMake
```

wingetãŒãªã„å ´åˆã¯ [ã‚¢ãƒ—ãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼](https://apps.microsoft.com/detail/9nblggh4nns1?rtc=1&hl=ja-jp&gl=JP)ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚  

:::

## ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

https://visualstudio.microsoft.com/ja/downloads/#build-tools-for-visual-studio-2022

`Build Tools for Visual Studio 2022` ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚  

:::details wingetã‚’ä½¿ã†å ´åˆ

```sh
winget install Microsoft.VisualStudio.2022.BuildTools
```

:::

ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ã¨Visual Studio InstallerãŒèµ·å‹•ã™ã‚‹ã®ã§ã€ã€ŒC++ã«ã‚ˆã‚‹ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—é–‹ç™ºã€ã‚’é¸æŠå¾Œã€å³ã®æ¬„ã‹ã‚‰ã€Œãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ç”¨C++ ATLã€ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚  

![vs installer](/images/opencv-setup/01.png)

## OpenCVã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

https://github.com/opencv/opencv/releases

`opencv-{version}-windows.exe` ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚  
ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¾Œã€å®Ÿè¡Œã™ã‚‹ã¨OpenCVã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ•ã‚©ãƒ«ãƒ€ã‚’é¸æŠã™ã‚‹ç”»é¢ã«ãªã‚‹ã®ã§ã€é©å½“ãªãƒ‘ã‚¹ã‚’è¨­å®šã—ã¾ã™ã€‚  
ã“ã“ã§ã¯Cãƒ‰ãƒ©ã‚¤ãƒ–ç›´ä¸‹ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚  

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ç’°å¢ƒå¤‰æ•°ã® `OpenCV_DIR` ã« `C:\OpenCV\build\x64\vc16` ã‚’ã€ `Path` ã« `%OPENCV_DIR%\bin` ã¨ `%OPENCV_DIR%\lib` ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚  

 ```powershell
 [Environment]::SetEnvironmentVariable("OpenCV_DIR", "C:\opencv\build\install\x64\vc17", "User")
 $oldPath = [Environment]::GetEnvironmentVariable("Path", "User")
 $newPath = $oldPath + ";%OPENCV_DIR%\bin;%OPENCV_DIR%\lib"
 [Environment]::SetEnvironmentVariable("Path", $newPath, "User")
 ```

ç’°å¢ƒå¤‰æ•°ã®è¨­å®šå¾Œã€PowerShellã‚’é–‹ãç›´ã—ã€ `opencv_version` ã¨å…¥åŠ›ã—ã¦ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ãŒå‡ºã¦ãã‚Œã°OKã§ã™ã€‚  

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ãƒ“ãƒ«ãƒ‰ã™ã‚‹å ´åˆã¯ä»¥ä¸‹ã®è¨˜äº‹ã§è§£èª¬ã—ã¦ã„ã¾ã™ã€‚  

https://zenn.dev/yashikota/articles/8528ea9afcc521

## OpenCVã‚’ä½¿ã£ã¦ã¿ã‚‹

ã“ã‚Œã§ç’°å¢ƒã¯æ•´ã£ãŸã®ã§OpenCVã‚’ä½¿ã£ãŸãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆã—ã¾ã™ã€‚  
`main.cpp` ã¨ `CMakeLists.txt` ã®2ã¤ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ç”¨æ„ã—ã¾ã™ã€‚  

```cpp:main.cpp
#include <opencv2/opencv.hpp>

int main() {
    cv::VideoCapture cap(0);
    if (!cap.isOpened()) return -1;

    cv::Mat frame;
    while (cap.read(frame)) {
        cv::imshow("test", frame);
        const int key = cv::waitKey(1);
        if (key == 'q') break;
    }
    cv::destroyAllWindows();

    return 0;
}
```

:::details WebCamã‚’ä½¿ã‚ãªã„ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å ´åˆ

```cpp:main.cpp
#include <iostream>
#include <opencv2/opencv.hpp>

int main() {
    // Windowsæ¨™æº–ã®å£ç´™ã‚’è¡¨ç¤º
    cv::Mat image = cv::imread("C:\\Windows\\Web\\Wallpaper\\Windows\\img0.jpg");
    if (image.empty()) {
        std::cout << "ç”»åƒãŒé–‹ã‘ã¾ã›ã‚“" << std::endl;
        return -1;
    }

    cv::resize(image, image, cv::Size(), 0.25, 0.25, cv::INTER_AREA);
    cv::imshow("test", image);

    cv::waitKey(0);

    return 0;
}
```

:::

```cmake:CMakeLists.txt
cmake_minimum_required(VERSION 3.0.0)
project(test VERSION 0.1.0 LANGUAGES CXX)

find_package(OpenCV REQUIRED)
include_directories(${OpenCV_INCLUDE_DIRS})

add_executable(test main.cpp)
target_link_libraries( ${PROJECT_NAME} ${OpenCV_LIBS} )
```

ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚  

```sh
cmake . -B build
cmake --build build
build\Debug\test.exe
```

ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°æˆåŠŸã§ã™ï¼  

## å‚è€ƒæ–‡çŒ®

https://docs.opencv.org/4.x/d7/d9f/tutorial_linux_install.html
https://docs.opencv.org/4.x/d3/d52/tutorial_windows_install.html#tutorial_windows_install_path
https://www.kkaneko.jp/tools/win/buildtool2022.html
https://swallow-incubate.com/archives/blog/20200508
https://sh-yoshida.hatenablog.com/entry/2017/05/27/012755
https://pystyle.info/opencv-how-to-build-opencv-on-windows
